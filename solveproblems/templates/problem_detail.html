{% extends 'base.html' %}

{% block title %}Problem{% endblock %}

{% block content %}
<form method="post">
    {% csrf_token %}
    <div class="container d-flex justify-content-center align-items-center">
        <!-- Select Language -->
        <select name="language" id="id_language" class="form-select me-2 bg-dark" style="width: auto;color:white;" required>
            <option value="" disabled>Select Language</option>
            <option value="py" {% if form.language.value == "py" or selected_language == "py" %}selected{% endif %}>Python</option>
            <option value="c" {% if form.language.value == "c" or selected_language == "c" %}selected{% endif %}>C</option>
            <option value="cpp" {% if form.language.value == "cpp" or selected_language == "cpp" %}selected{% endif %}>C++</option>
        </select>
        
        <button type="submit" class="btn btn-primary">Run Code</button>
    </div>

   <div class="row">
        <div class="col-md-6 ps-5">
            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" class="form-control bg-dark" rows="20" readonly style="color:white;">{{ problem.description }}</textarea>
            </div>
        </div>

        <div class="col-md-6 pe-5">
            <div class="form-group">
                <!-- Buttons for Code and Test Cases -->
                <button id="codeButton" type="button" class="btn mb-3 bg-dark" style="color:white;">Code</button>
                <button id="testCasesButton" type="button" class="btn btn-secondary mb-3">Test Cases</button>
            </div>

            <!-- Single section to show either Code or Test Cases -->
            <div id="displaySection" class="form-group">
                <!-- Code Textarea, with the code retained after submission -->
                <textarea name="code" id="id_code" class="form-control bg-dark" rows="10" style="color:white; display:none;">{{ form.code.value|default:code_value }}</textarea>

                <!-- Test Cases section (Initially Hidden) -->
                <div id="testCasesSection" >
                    <!-- Dynamic buttons for each test case -->
                    <div class="mb-2">
                        {% for test_case in test_cases %}
                          {% if test_case.result %}
                            <button type="button" class="btn btn-success testCaseButton" data-input="{{ test_case.input }}" data-output="{{ test_case.output }}">
                                Test Case {{ forloop.counter }}
                            </button>

                          {%elif  test_case.result == None %}

                            <button type="button" class="btn btn-secondary testCaseButton" data-input="{{ test_case.input }}" data-output="{{ test_case.output }}">
                                Test Case {{ forloop.counter }}
                            </button>
                          {%else %}
                            <button type="button" class="btn btn-warning testCaseButton" data-input="{{ test_case.input }}" data-output="{{ test_case.output }}">
                                Test Case {{ forloop.counter }}
                            </button>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <textarea id="test_cases" class="form-control bg-dark" rows="10" readonly style="color:white;"></textarea>
                </div>
            </div>
        </div>
   </div>
</form>

<script>
    // JavaScript to toggle between Code and Test Cases sections
    const codeButton = document.getElementById('codeButton');
    const testCasesButton = document.getElementById('testCasesButton');
    const codeTextarea = document.getElementById('id_code');
    const testCasesSection = document.getElementById('testCasesSection');
    const runCodeButton = document.querySelector('button[type="submit"]');

    // Show Code textarea and hide Test Cases
    codeButton.addEventListener('click', function() {
        codeTextarea.style.display = "block";  // Show code
        testCasesSection.style.display = "none";  // Hide test cases section
    });

    // Show Test Cases section and hide Code textarea
    testCasesButton.addEventListener('click', function() {
        testCasesSection.style.display = "block";  // Show test cases section
        codeTextarea.style.display = "none";  // Hide code
    });
    // Trigger testCasesButton event when Run Code is pressed
    runCodeButton.addEventListener('click', function() {
        testCasesButton.click();  // Simulate click on the Test Cases button
    });

    // Add event listeners to all test case buttons
    document.querySelectorAll('.testCaseButton').forEach(button => {
        button.addEventListener('click', function() {
            const input = this.getAttribute('data-input');
            const output = this.getAttribute('data-output');
            document.getElementById('test_cases').value = `Input: ${input}\nOutput: ${output}`;  // Load selected test case details
        });
    });
</script>
{% endblock %}
